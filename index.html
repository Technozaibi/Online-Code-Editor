<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Advanced Online Code Editor</title>
   <!-- Tailwind CSS CDN -->
   <script src="https://cdn.tailwindcss.com"></script>
   <!-- Inter Font -->
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
   <!-- CodeMirror CSS -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
   <style>
       body {
           font-family: 'Inter', sans-serif;
           margin: 0;
           padding: 0;
           display: flex;
           flex-direction: column;
           min-height: 100vh;
           background-color: #f3f4f6; /* Light gray background */
           color: #1f2937; /* Dark gray text */
       }
       .dark body {
           background-color: #1a202c; /* Dark background */
           color: #e2e8f0; /* Light text */
       }
       .CodeMirror {
           height: 100%;
           font-size: 1rem;
           border-radius: 0.5rem; /* Rounded corners for editor */
           overflow: hidden; /* Ensure content stays within rounded corners */
       }
       .CodeMirror-scroll {
           padding-bottom: 10px; /* Add some padding at the bottom for better scrolling */
       }
       .editor-container {
           display: flex;
           flex-direction: column;
           gap: 1rem;
           height: 100%;
       }
       .preview-iframe {
           width: 100%;
           height: 100%;
           border: none;
           background-color: white;
           border-radius: 0.5rem;
       }
       .dark .preview-iframe {
           background-color: #2d3748; /* Darker background for preview in dark mode */
       }
       .modal {
           display: none; /* Hidden by default */
           position: fixed; /* Stay in place */
           z-index: 1000; /* Sit on top */
           left: 0;
           top: 0;
           width: 100%; /* Full width */
           height: 100%; /* Full height */
           overflow: auto; /* Enable scroll if needed */
           background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
           justify-content: center;
           align-items: center;
       }
       .modal-content {
           background-color: #fefefe;
           margin: auto;
           padding: 2rem;
           border-radius: 0.75rem;
           width: 90%;
           max-width: 800px;
           position: relative;
           box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
       }
       .dark .modal-content {
           background-color: #2d3748;
           color: #e2e8f0;
       }
       .close-button {
           position: absolute;
           top: 1rem;
           right: 1.5rem;
           color: #aaa;
           font-size: 2rem;
           font-weight: bold;
           cursor: pointer;
       }
       .close-button:hover,
       .close-button:focus {
           color: #333;
           text-decoration: none;
           cursor: pointer;
       }
       .dark .close-button:hover,
       .dark .close-button:focus {
           color: #ccc;
       }
       .file-entry {
           cursor: pointer;
           padding: 0.5rem;
           border-radius: 0.25rem;
           transition: background-color 0.2s;
       }
       .file-entry:hover {
           background-color: #e5e7eb;
       }
       .dark .file-entry:hover {
           background-color: #4a5568;
       }
   </style>
</head>
<body class="flex flex-col min-h-screen">
   <!-- Header -->
   <header class="bg-blue-600 text-white p-4 shadow-lg">
       <div class="container mx-auto flex flex-col sm:flex-row justify-between items-center">
           <h1 class="text-3xl font-bold mb-2 sm:mb-0">Code Editor</h1>
           <nav class="space-x-4">
               <button id="dark-mode-toggle" class="bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                   Toggle Dark Mode
               </button>
           </nav>
       </div>
   </header>

   <!-- Main Content Area -->
   <main class="flex-grow container mx-auto p-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
       <!-- Editor Section -->
       <section class="flex flex-col space-y-4">
           <!-- Editor Controls -->
           <div class="flex flex-wrap gap-3 p-4 bg-white rounded-lg shadow-md dark:bg-gray-800">
               <label for="file-input" class="cursor-pointer bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                   Load File(s)
                   <input type="file" id="file-input" multiple accept=".html,.css,.js" class="hidden">
               </label>
               <button id="download-code" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                   Download All Code
               </button>
               <button id="reset-editor" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                   Reset Editor
               </button>
           </div>

           <!-- Code Editors -->
           <div class="flex flex-col sm:flex-row gap-4 flex-grow">
               <div class="flex-1 bg-white p-3 rounded-lg shadow-md dark:bg-gray-800 flex flex-col">
                   <label for="html-code" class="block text-lg font-semibold mb-2 text-gray-700 dark:text-gray-300">HTML</label>
                   <textarea id="html-code" class="flex-grow resize-none border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 p-2 text-gray-800 dark:text-gray-200 dark:bg-gray-700"></textarea>
               </div>
               <div class="flex-1 bg-white p-3 rounded-lg shadow-md dark:bg-gray-800 flex flex-col">
                   <label for="css-code" class="block text-lg font-semibold mb-2 text-gray-700 dark:text-gray-300">CSS</label>
                   <textarea id="css-code" class="flex-grow resize-none border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 p-2 text-gray-800 dark:text-gray-200 dark:bg-gray-700"></textarea>
               </div>
               <div class="flex-1 bg-white p-3 rounded-lg shadow-md dark:bg-gray-800 flex flex-col">
                   <label for="js-code" class="block text-lg font-semibold mb-2 text-gray-700 dark:text-gray-300">JavaScript</label>
                   <textarea id="js-code" class="flex-grow resize-none border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 p-2 text-gray-800 dark:text-gray-200 dark:bg-gray-700"></textarea>
               </div>
           </div>

           <!-- File Viewer -->
           <div class="bg-white p-4 rounded-lg shadow-md dark:bg-gray-800">
               <h2 class="text-xl font-semibold mb-3 text-gray-700 dark:text-gray-300">Loaded Files</h2>
               <ul id="file-list" class="space-y-2 text-gray-800 dark:text-gray-200">
                   <li class="text-gray-500 dark:text-gray-400">No files loaded yet.</li>
               </ul>
           </div>
       </section>

       <!-- Live Preview Section -->
       <section class="flex flex-col space-y-4">
           <div class="flex-grow bg-white p-3 rounded-lg shadow-md dark:bg-gray-800">
               <h2 class="text-xl font-semibold mb-3 text-gray-700 dark:text-gray-300">Live Preview</h2>
               <iframe id="live-preview" class="preview-iframe flex-grow"></iframe>
           </div>
       </section>
   </main>

   <!-- Footer -->
   <footer class="bg-gray-800 text-white p-6 text-center shadow-inner mt-auto">
       <div class="container mx-auto">
           <p class="mb-4">© 2025 Advanced Code Editor. All rights reserved.</p>
           <nav class="space-x-4">
               <a href="#" id="privacy-policy-link" class="text-gray-300 hover:text-white transition duration-300 ease-in-out">Privacy Policy</a>
               <a href="#" id="terms-of-service-link" class="text-gray-300 hover:text-white transition duration-300 ease-in-out">Terms of Service</a>
               <a href="#" id="about-us-link" class="text-gray-300 hover:text-white transition duration-300 ease-in-out">About Us</a>
               <a href="#" id="contact-us-link" class="text-gray-300 hover:text-white transition duration-300 ease-in-out">Contact Us</a>
           </nav>
       </div>
   </footer>

   <!-- Modals for AdSense Pages -->
   <div id="privacy-policy-modal" class="modal">
       <div class="modal-content">
           <span class="close-button">×</span>
           <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Privacy Policy</h2>
           <p class="text-gray-700 dark:text-gray-300">
               This Privacy Policy describes how your personal information is collected, used, and shared when you visit or use Advanced Code Editor.
               We do not collect any personally identifiable information from our users. All code you write or upload remains on your local device and is not transmitted to our servers.
               We may use third-party services like Google AdSense to display advertisements. These services may use cookies to serve ads based on your prior visits to this or other websites.
               You can opt out of personalized advertising by visiting Ads Settings.
               This policy is subject to change. Please review it periodically.
           </p>
       </div>
   </div>

   <div id="terms-of-service-modal" class="modal">
       <div class="modal-content">
           <span class="close-button">×</span>
           <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Terms of Service</h2>
           <p class="text-gray-700 dark:text-gray-300">
               Welcome to Advanced Code Editor. By accessing or using our service, you agree to be bound by these Terms of Service.
               This editor is provided for educational and development purposes. We are not responsible for any code you write or its consequences.
               You agree not to use the service for any unlawful or prohibited activities.
               The content you create using this editor is solely your responsibility.
               We reserve the right to modify or terminate the service for any reason, without notice at any time.
               All intellectual property rights in the service itself (excluding user-generated content) are owned by Advanced Code Editor.
           </p>
       </div>
   </div>

   <div id="about-us-modal" class="modal">
       <div class="modal-content">
           <span class="close-button">×</span>
           <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">About Us</h2>
           <p class="text-gray-700 dark:text-gray-300">
               Advanced Code Editor is designed to provide a simple yet powerful online environment for front-end web development.
               Our goal is to help developers and learners quickly prototype, experiment, and visualize their HTML, CSS, and JavaScript code in real-time.
               We believe in making coding accessible and efficient. This editor is constantly evolving with new features and improvements.
               Thank you for using our tool!
           </p>
       </div>
   </div>

   <div id="contact-us-modal" class="modal">
       <div class="modal-content">
           <span class="close-button">×</span>
           <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Contact Us</h2>
           <p class="text-gray-700 dark:text-gray-300">
               If you have any questions, feedback, or suggestions, please feel free to reach out to us.
               You can contact us via email at: <a href="mailto:support@example.com" class="text-blue-600 hover:underline">support@example.com</a>.
               We appreciate your input and will do our best to respond promptly.
           </p>
       </div>
   </div>

   <!-- CodeMirror JS -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>

   <script>
       // Initialize CodeMirror editors
       const htmlEditor = CodeMirror.fromTextArea(document.getElementById('html-code'), {
           mode: 'xml',
           htmlMode: true,
           lineNumbers: true,
           theme: 'default',
           indentUnit: 4,
           tabSize: 4,
           indentWithTabs: true,
           lineWrapping: true,
       });

       const cssEditor = CodeMirror.fromTextArea(document.getElementById('css-code'), {
           mode: 'css',
           lineNumbers: true,
           theme: 'default',
           indentUnit: 4,
           tabSize: 4,
           indentWithTabs: true,
           lineWrapping: true,
       });

       const jsEditor = CodeMirror.fromTextArea(document.getElementById('js-code'), {
           mode: 'javascript',
           lineNumbers: true,
           theme: 'default',
           indentUnit: 4,
           tabSize: 4,
           indentWithTabs: true,
           lineWrapping: true,
       });

       const livePreview = document.getElementById('live-preview');
       const fileInput = document.getElementById('file-input');
       const downloadCodeBtn = document.getElementById('download-code');
       const resetEditorBtn = document.getElementById('reset-editor');
       const fileList = document.getElementById('file-list');
       const darkModeToggle = document.getElementById('dark-mode-toggle');

       // Store loaded files' content for display in file viewer
       const loadedFiles = {};

       /**
        * Updates the live preview iframe with the current HTML, CSS, and JavaScript code.
        */
       function updatePreview() {
           const htmlCode = htmlEditor.getValue();
           const cssCode = cssEditor.getValue();
           const jsCode = jsEditor.getValue();

           const combinedCode = `
               <!DOCTYPE html>
               <html>
               <head>
                   <style>${cssCode}</style>
               </head>
               <body>
                   ${htmlCode}
                   <script>${jsCode}<\/script>
               </body>
               </html>
           `;
           livePreview.srcdoc = combinedCode;
       }

       // Event listeners for code changes
       htmlEditor.on('change', updatePreview);
       cssEditor.on('change', updatePreview);
       jsEditor.on('change', updatePreview);

       // Initial preview update on load
       updatePreview();

       /**
        * Handles file loading from user's local machine.
        * Reads file content and populates appropriate editor or file viewer.
        */
       fileInput.addEventListener('change', (event) => {
           const files = event.target.files;
           if (files.length === 0) {
               return;
           }

           fileList.innerHTML = ''; // Clear previous file list
           const fragment = document.createDocumentFragment(); // Use fragment for performance

           Array.from(files).forEach(file => {
               const reader = new FileReader();
               reader.onload = (e) => {
                   const content = e.target.result;
                   const fileName = file.name;
                   loadedFiles[fileName] = content; // Store content

                   const fileExtension = fileName.split('.').pop().toLowerCase();

                   // Populate editor based on file type
                   if (fileExtension === 'html') {
                       htmlEditor.setValue(content);
                   } else if (fileExtension === 'css') {
                       cssEditor.setValue(content);
                   } else if (fileExtension === 'js') {
                       jsEditor.setValue(content);
                   }

                   // Add file to the list for viewing
                   const listItem = document.createElement('li');
                   listItem.className = 'file-entry border border-gray-200 dark:border-gray-700 rounded-md p-2 flex justify-between items-center';
                   listItem.innerHTML = `
                       <span>${fileName}</span>
                       <button data-filename="${fileName}" class="view-file-btn bg-blue-500 hover:bg-blue-600 text-white text-sm py-1 px-3 rounded-md transition duration-300 ease-in-out transform hover:scale-105">View</button>
                   `;
                   fragment.appendChild(listItem);
               };
               reader.readAsText(file);
           });
           fileList.appendChild(fragment);
           if (Object.keys(loadedFiles).length === 0) {
               fileList.innerHTML = '<li class="text-gray-500 dark:text-gray-400">No files loaded yet.</li>';
           }
       });

       /**
        * Handles viewing a loaded file's content in a temporary modal.
        */
       fileList.addEventListener('click', (event) => {
           if (event.target.classList.contains('view-file-btn')) {
               const fileName = event.target.dataset.filename;
               const fileContent = loadedFiles[fileName];

               if (fileContent) {
                   const viewModal = document.createElement('div');
                   viewModal.className = 'modal';
                   viewModal.innerHTML = `
                       <div class="modal-content">
                           <span class="close-button">×</span>
                           <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Content of: ${fileName}</h2>
                           <pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md overflow-auto max-h-96 text-gray-800 dark:text-gray-200">${escapeHTML(fileContent)}</pre>
                       </div>
                   `;
                   document.body.appendChild(viewModal);
                   viewModal.style.display = 'flex';

                   viewModal.querySelector('.close-button').addEventListener('click', () => {
                       viewModal.style.display = 'none';
                       document.body.removeChild(viewModal);
                   });
                   viewModal.addEventListener('click', (e) => {
                       if (e.target === viewModal) {
                           viewModal.style.display = 'none';
                           document.body.removeChild(viewModal);
                       }
                   });
               }
           }
       });

       /**
        * Escapes HTML entities to display raw code safely in <pre> tags.
        * @param {string} str - The string to escape.
        * @returns {string} The escaped string.
        */
       function escapeHTML(str) {
           const div = document.createElement('div');
           div.appendChild(document.createTextNode(str));
           return div.innerHTML;
       }

       /**
        * Downloads all current code (HTML, CSS, JS) as a single HTML file.
        */
       downloadCodeBtn.addEventListener('click', () => {
           const htmlCode = htmlEditor.getValue();
           const cssCode = cssEditor.getValue();
           const jsCode = jsEditor.getValue();

           const fullCode = `
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>My Downloaded Code</title>
   <style>
       ${cssCode}
   </style>
</head>
<body>
   ${htmlCode}
   <script>
       ${jsCode}
   <\/script>
</body>
</html>
           `;

           const blob = new Blob([fullCode], { type: 'text/html' });
           const url = URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = 'my_code_project.html';
           document.body.appendChild(a);
           a.click();
           document.body.removeChild(a);
           URL.revokeObjectURL(url);
       });

       /**
        * Resets all code editors and clears the file viewer.
        */
       resetEditorBtn.addEventListener('click', () => {
           htmlEditor.setValue('');
           cssEditor.setValue('');
           jsEditor.setValue('');
           livePreview.srcdoc = ''; // Clear preview
           fileList.innerHTML = '<li class="text-gray-500 dark:text-gray-400">No files loaded yet.</li>';
           for (const key in loadedFiles) {
               delete loadedFiles[key]; // Clear stored files
           }
           updatePreview(); // Re-render empty preview
       });

       /**
        * Toggles dark mode for the entire application.
        */
       darkModeToggle.addEventListener('click', () => {
           document.body.classList.toggle('dark');
           // Update CodeMirror theme if needed (CodeMirror has its own themes)
           // For simplicity, we are using default theme which adapts to background
           // If you had a specific dark theme for CM, you'd set it here:
           // htmlEditor.setOption('theme', document.body.classList.contains('dark') ? 'monokai' : 'default');
           // cssEditor.setOption('theme', document.body.classList.contains('dark') ? 'monokai' : 'default');
           // jsEditor.setOption('theme', document.body.classList.contains('dark') ? 'monokai' : 'default');
       });

       // Modal functionality for AdSense pages
       const modals = {
           'privacy-policy': document.getElementById('privacy-policy-modal'),
           'terms-of-service': document.getElementById('terms-of-service-modal'),
           'about-us': document.getElementById('about-us-modal'),
           'contact-us': document.getElementById('contact-us-modal')
       };

       const modalLinks = {
           'privacy-policy-link': 'privacy-policy',
           'terms-of-service-link': 'terms-of-service',
           'about-us-link': 'about-us',
           'contact-us-link': 'contact-us'
       };

       /**
        * Opens a specific modal.
        * @param {HTMLElement} modalElement - The modal element to open.
        */
       function openModal(modalElement) {
           modalElement.style.display = 'flex';
       }

       /**
        * Closes a specific modal.
        * @param {HTMLElement} modalElement - The modal element to close.
        */
       function closeModal(modalElement) {
           modalElement.style.display = 'none';
       }

       // Attach event listeners to footer links to open modals
       for (const linkId in modalLinks) {
           document.getElementById(linkId).addEventListener('click', (event) => {
               event.preventDefault(); // Prevent default link behavior
               const modalKey = modalLinks[linkId];
               openModal(modals[modalKey]);
           });
       }

       // Attach event listeners to close buttons and outside clicks for modals
       for (const modalKey in modals) {
           const modal = modals[modalKey];
           modal.querySelector('.close-button').addEventListener('click', () => {
               closeModal(modal);
           });
           // Close when clicking outside the modal content
           modal.addEventListener('click', (event) => {
               if (event.target === modal) {
                   closeModal(modal);
               }
           });
       }

       // Set initial content for editors for demonstration
       htmlEditor.setValue(`<!-- Welcome to the HTML editor! -->
<div class="container">
   <h1>Hello, Code Editor!</h1>
   <p>Start writing your HTML, CSS, and JavaScript here.</p>
   <button id="myButton">Click Me</button>
</div>`);

       cssEditor.setValue(`/* Welcome to the CSS editor! */
body {
   font-family: 'Inter', sans-serif;
   display: flex;
   justify-content: center;
   align-items: center;
   min-height: 100vh;
   margin: 0;
   background-color: #f0f8ff;
   color: #333;
}

.container {
   background-color: #ffffff;
   padding: 2.5rem;
   border-radius: 1rem;
   box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
   text-align: center;
   max-width: 500px;
   width: 90%;
}

h1 {
   color: #4a90e2;
   margin-bottom: 1rem;
}

p {
   line-height: 1.6;
   margin-bottom: 1.5rem;
}

button {
   background-color: #4CAF50;
   color: white;
   padding: 0.8rem 1.5rem;
   border: none;
   border-radius: 0.5rem;
   cursor: pointer;
   font-size: 1rem;
   transition: background-color 0.3s ease, transform 0.2s ease;
}

button:hover {
   background-color: #45a049;
   transform: translateY(-2px);
}
`);

       jsEditor.setValue(`// Welcome to the JavaScript editor!
document.addEventListener('DOMContentLoaded', () => {
   const button = document.getElementById('myButton');
   if (button) {
       button.addEventListener('click', () => {
           alert('Button clicked! You can write your JavaScript logic here.');
           // In a real app, avoid alert() and use a custom modal or console.log
           console.log('Button was clicked!');
           document.querySelector('p').textContent = 'You clicked the button!';
       });
   }
});`);

       // Ensure CodeMirror refreshes its layout after content is set
       setTimeout(() => {
           htmlEditor.refresh();
           cssEditor.refresh();
           jsEditor.refresh();
           updatePreview(); // Ensure preview is updated after initial content load
       }, 100); // Small delay to ensure DOM is ready
   </script>
</body>
</html>
